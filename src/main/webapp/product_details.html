<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=9; IE=8; IE=7; IE=EDGE">
    <meta http-equiv="X-UA-Compatible" content="IE=EmulateIE7"/>
    <title>产品详情页</title>
    <link rel="icon" href="assets/img/favicon.ico">

    <link rel="stylesheet" type="text/css" href="css/webbase.css"/>
    <link rel="stylesheet" type="text/css" href="css/pages-item.css"/>
    <link rel="stylesheet" type="text/css" href="css/pages-zoom.css"/>
    <link rel="stylesheet" type="text/css" href="css/widget-cartPanelView.css"/>
    <script type="text/javascript" src="plugins/angularjs/angular.min.js"></script>
    <script type="text/javascript" src="js/base.js"></script>
    <script type="text/javascript" src="js/controller/itemController.js"></script>
    <script src="jquery/jquery-2.1.1.min.js"></script>
    <script src="bootstrap/js/bootstrap.min.js"></script>
    <script src="script/docs.min.js"></script>
    <style>
        #item-name {
            font-family: 黑体;
            font-size: 22px;
        }

        #item-price {
            font-size: 25px;
            font-family: 仿宋;
        }
    </style>
</head>

<body ng-app="pinyougou" ng-controller="itemController" ng-init="num=1">

<!--页面顶部 开始-->
<div class="headerpage"></div>
<!--页面顶部 结束-->
<!--product-info-->
<div id="datadiv" style="margin-top:0px;" style="margin-right:20px;" align="center">
</div>
<!-- 底部栏位 -->

<!--页面底部  开始 -->

<!--侧栏面板开始-->
<div class="J-global-toolbar">
    <div class="toolbar-wrap J-wrap">
        <div class="toolbar">
            <div class="toolbar-panels J-panel">

                <!-- 购物车 -->
                <div style="visibility: hidden;"
                     class="J-content toolbar-panel tbar-panel-cart toolbar-animate-out">
                    <h3 class="tbar-panel-header J-panel-header">
                        <a href="" class="title"><i></i><em class="title">购物车</em></a>
                        <span class="close-panel J-close"
                              onclick="cartPanelView.tbar_panel_close('cart');"></span>
                    </h3>
                    <div class="tbar-panel-main">
                        <div class="tbar-panel-content J-panel-content">
                            <div id="J-cart-tips" class="tbar-tipbox hide">
                                <div class="tip-inner">
                                    <span class="tip-text">还没有登录，登录后商品将被保存</span>
                                    <a href="#none" class="tip-btn J-login">登录</a>
                                </div>
                            </div>
                            <div id="J-cart-render">
                                <!-- 列表 -->
                                <div id="cart-list" class="tbar-cart-list">
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- 小计 -->
                    <div id="cart-footer" class="tbar-panel-footer J-panel-footer">
                        <div class="tbar-checkout">
                            <div class="jtc-number"><strong class="J-count" id="cart-number">0</strong>件商品</div>
                            <div class="jtc-sum"> 共计：<strong class="J-total" id="cart-sum">¥0</strong></div>
                            <a class="jtc-btn J-btn" href="#none" target="_blank">去购物车结算</a>
                        </div>
                    </div>
                </div>

                <!-- 我的关注 -->
                <div style="visibility: hidden;" data-name="follow"
                     class="J-content toolbar-panel tbar-panel-follow">
                    <h3 class="tbar-panel-header J-panel-header">
                        <a href="#" target="_blank" class="title"> <i></i> <em class="title">我的关注</em> </a>
                        <span class="close-panel J-close"
                              onclick="cartPanelView.tbar_panel_close('follow');"></span>
                    </h3>
                    <div class="tbar-panel-main">
                        <div class="tbar-panel-content J-panel-content">
                            <div class="tbar-tipbox2">
                                <div class="tip-inner"><i class="i-loading"></i></div>
                            </div>
                        </div>
                    </div>
                    <div class="tbar-panel-footer J-panel-footer"></div>
                </div>

                <!-- 我的足迹 -->
                <div style="visibility: hidden;"
                     class="J-content toolbar-panel tbar-panel-history toolbar-animate-in">
                    <h3 class="tbar-panel-header J-panel-header">
                        <a href="#" target="_blank" class="title"> <i></i> <em class="title">我的足迹</em> </a>
                        <span class="close-panel J-close"
                              onclick="cartPanelView.tbar_panel_close('history');"></span>
                    </h3>
                    <div class="tbar-panel-main">
                        <div class="tbar-panel-content J-panel-content">
                            <div class="jt-history-wrap">
                                <ul>
                                </ul>
                                <a href="#" class="history-bottom-more" target="_blank">查看更多足迹商品 &gt;&gt;</a>
                            </div>
                        </div>
                    </div>
                    <div class="tbar-panel-footer J-panel-footer"></div>
                </div>

            </div>

            <div class="toolbar-header"></div>

            <!-- 侧栏按钮 -->
            <div class="toolbar-tabs J-tab">
                <div onclick="ClickCart()" class="toolbar-tab tbar-tab-cart" data="购物车"
                     tag="cart">
                    <i class="tab-ico"></i>
                    <em class="tab-text"></em>
                    <span class="tab-sub J-count " id="tab-sub-cart-count">0</span>
                </div>
                <div onclick="cartPanelView.tabItemClick('follow')" class="toolbar-tab tbar-tab-follow"
                     data="我的关注" tag="follow">
                    <i class="tab-ico"></i>
                    <em class="tab-text"></em>
                    <span class="tab-sub J-count hide">0</span>
                </div>
                <div onclick="cartPanelView.tabItemClick('history')" class="toolbar-tab tbar-tab-history"
                     data="我的足迹" tag="history">
                    <i class="tab-ico"></i>
                    <em class="tab-text"></em>
                    <span class="tab-sub J-count hide">0</span>
                </div>
            </div>

            <div class="toolbar-footer">
                <div class="toolbar-tab tbar-tab-top"><a href="#"> <i class="tab-ico  "></i> <em
                        class="footer-tab-text">顶部</em> </a></div>
                <div class="toolbar-tab tbar-tab-feedback"><a href="#" target="_blank"> <i class="tab-ico"></i>
                    <em class="footer-tab-text ">反馈</em> </a></div>
            </div>

            <div class="toolbar-mini"></div>

        </div>

        <div id="J-toolbar-load-hook"></div>

    </div>
</div>

<script type="text/template" id="tbar-cart-item-template">
    <div class="tbar-cart-item">
        <div class="jtc-item-promo">
            <em class="promo-tag promo-mz">满赠<i class="arrow"></i></em>
            <div class="promo-text">已购满600元，您可领赠品</div>
        </div>
        <div class="jtc-item-goods">
                    <span class="p-img"><a href="#" target="_blank"><img src="{2}" alt="{1}" height="50"
                                                                         width="50"/></a></span>
            <div class="p-name">
                <a href="#">{1}</a>
            </div>
            <div class="p-price"><strong>¥{3}</strong>×{4}</div>
            <a href="#none" class="p-del J-del">删除</a>
        </div>
    </div>
</script>


<script type="text/javascript" src="js/plugins/jquery/jquery.min.js"></script>
<script type="text/javascript">
    $(function () {
        $("#service").hover(function () {
            $(".service").show();
        }, function () {
            $(".service").hide();
        });
        $("#shopcar").hover(function () {
            $("#shopcarlist").show();
        }, function () {
            $("#shopcarlist").hide();
        });

    })
</script>
<script type="text/javascript" src="js/model/cartModel.js"></script>
<script type="text/javascript" src="js/plugins/jquery.easing/jquery.easing.min.js"></script>
<script type="text/javascript" src="js/plugins/sui/sui.min.js"></script>
<script type="text/javascript" src="js/plugins/jquery.jqzoom/jquery.jqzoom.js"></script>
<script type="text/javascript" src="js/plugins/jquery.jqzoom/zoom.js"></script>
<!--<script type="text/javascript" src="index/index.js"></script>-->
<!--页面底部 开始-->
<div class="footerpage"></div>
<!--页面底部  结束 -->
<!--<script src="js/jquery.min.js"></script>-->
<script>
    $(function () {
        $(".headerpage").load("/headerAndFooter/header.html");
        $(".footerpage").load("/headerAndFooter/footer.html");
    });
</script>
<script>
    // 判断用户是否登录
    console.log("判断是否登录!");

    $.ajax({

        url: "http://localhost:8080//checkIfLogin",
        success: function (result) {
            console.log("success检测用户是否登录");

            if (result) {
                $("#checkIfLogin").html("");
                $(result).each(function (index, item) {
                    var trStr = "<ul class=\"fl\">";
                    trStr += "<li class=\"f-item\">品优购欢迎您！</li>";
                    trStr += "<li class=\"f-item\">" + item.username + "</li>&ensp;&ensp;";
                    trStr += "<li class=\"f-item\"><span><a onclick=\"logOut()\" target=\"_blank\">退出</a></span></li>";
                    trStr += "</ul>";
                    $("#checkIfLogin").append(trStr);
                    console.log("用户已登陆");
                    console.log(item);
                    sessionStorage.setItem("userid", item.userid);

                });
            } else {
                console.log("用户未登录")
            }

        },
        error: function (e) {
            console.log(e);
            console.log(e.status);
            console.log(e.responseText);
        }
    })

</script>

<script>
    function initPage() {
        console.log("============================");
        var goodsid = sessionStorage.getItem("goodsid");
        //alert(goodsid);
        $.ajax({
            //请求方式GET/POST
            type: "POST",
            //请求的媒体类型
            contentType: "application/json;charset=UTF-8",
            //接受数据类型
            dataType: "json",
            //请求地址
            url: "http://localhost:8080//getGoodsInfoById?id="+goodsid,
            //数据，json字符串
            //请求成功
            success: function (result) {
                console.log(result);
                $("#datadiv").html("");
                $(result).each(function (index, item) {
                    var trstr = "<td width=\"500\">"+ "<img src="+item.goodsPic+" width=450 height=300 >";
                    trstr += "</td>";
                    trstr += "<div class=\"fr itemInfo-wrap\">";
                    trstr += "<td height=300>";
                    trstr += "<div class=\"fr itemInfo-wrap\">";
                    trstr += "<div class=\"sku-name\">";
                    trstr += "<h2>" + item.goodsName + "</h2>";
                    trstr += "</div>";
                    trstr += "<div class=\"news\">";
                    trstr += "<span>打折促销 </span>";
                    trstr += "</div>";
                    trstr += "<div class=\"summary\">";
                    trstr += "<div class=\"summary-wrap\">";
                    trstr += "<div class=\"fl title\">";
                    trstr += "<i>价　　格:</i>";
                    trstr += "<i id=\"item-price\">" + item.goodsPrice + "</i>";
                    trstr += "</div>";
                    trstr += "<div class=\"fl price\">";
                    trstr += "<i>¥</i>";
                    trstr += "<span>降价通知</span>";
                    trstr += "</div>";
                    trstr += "<div class=\"fr remark\">";
                    trstr += "<i>累计评价</i><em>612188</em>";
                    trstr += "</div>";
                    trstr += "</div>";
                    trstr += "<div class=\"summary-wrap\">";
                    trstr += "<div class=\"fl title\">";
                    trstr += "<i>促　　销</i>";
                    trstr += "</div>";
                    trstr += "<div class=\"fl fix-width\">";
                    trstr += "<i class=\"red-bg\">加价购</i>";
                    trstr += "<em class=\"t-gray\">满999.00另加20.00元，或满1999.00另加30.00元，或满2999.00另加40.00元，即可在购物车换\n" +
                        "购热销商品</em>";
                    trstr += "</div>";
                    trstr += "</div>";
                    trstr += "</div>";
                    trstr += "<div class=\"support\">";
                    trstr += "<div class=\"summary-wrap\">";
                    trstr += "<div class=\"fl title\">";
                    trstr += "<i>支　　持</i>";
                    trstr += "</div>";
                    trstr += "<div class=\"fl fix-width\">";
                    trstr += "<em class=\"t-gray\">以旧换新，闲置手机回收  4G套餐超值抢  礼品购</em>";
                    trstr += "</div>";
                    trstr += "</div>";
                    trstr += "";
                    trstr += "<div class=\"summary-wrap\">";
                    trstr += "<div class=\"fl title\">";
                    trstr += "<i>配 送 至</i>";
                    trstr += "</div>";
                    trstr += "<div class=\"fl fix-width\">";
                    trstr += "<em class=\"t-gray\">满999.00另加20.00元，或满1999.00另加30.00元，或满2999.00另加40.00元，即可在购物车换购热销商品</em>";
                    trstr += "</div>";
                    trstr += "</div>";
                    trstr += "</div>";
                    trstr += "<div class=\"fl\">";
                    trstr += "<ul class=\"btn-choose unstyled\">";
                    trstr += "<li>";
                    trstr += "<a class=\"sui-btn  btn-danger addshopcar\" onclick=''>立即购买</a>";
                    trstr += "</li>";
                    trstr += "<li>";
                    trstr += "<a class=\"sui-btn  btn-danger addshopcar\" onclick='addCart(" + item.goodsId + ")'>加入购物车</a>";
                    trstr += "</li>";
                    trstr += "</ul>";
                    trstr += "</div>";
                    trstr += "</div>";
                    trstr +="</td>";
                    trstr += "</div>";
                    $("#datadiv").append(trstr);
                })
            },
            error: function (e) {
                console.error(e);
                console.log(e.status);
                console.log(e.responseText);
            }
        })
    }

    initPage();

    // 加入购物车并判断是否登录
    function addCart(goodsid) {
        // 先判断是否登录
        var userid = sessionStorage.getItem("userid");
        console.log("登录用户id为" + userid);
        //alert(userid);
        //alert(goodsid);
        if (userid != null) {
            $.ajax({
                //请求方式GET/POST
                type: "POST",
                //请求的媒体类型
                contentType: "application/json;charset=UTF-8",
                //接受数据类型
                dataType: "json",
                //请求地址
                url: "http://localhost:8080//addCart",

                data: JSON.stringify({
                    "userid": userid,
                    "goodsid": goodsid
                }),
                success: function (result) {
                    console.log(result);
                    if (result) {
                        alert("加入购物车")
                    } else {
                        alert("加入购物车失败")
                    }
                },
                error: function (e) {
                    console.log(e);
                    console.log(e.status);
                    console.log(e.responseText);
                }
            })
        } else {
            //提示登录 跳转到登录页
            var b = confirm("请先登录!");
            if (b == true) {
                window.location.href = "login.html";
            }
        }

    }
    function ClickCart() {
        window.location.href="cart1.html"
    }
</script>
</body>
</html>