<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=9; IE=8; IE=7; IE=EDGE">
    <meta http-equiv="X-UA-Compatible" content="IE=EmulateIE7" />
    <title>我的足迹</title>
    <link rel="icon" href="assets/img/favicon.ico">

    <link rel="stylesheet" href="bootstrap/css/bootstrap.min.css">


    <link rel="stylesheet" type="text/css" href="css/webbase.css" />
    <link rel="stylesheet" type="text/css" href="css/pages-seckillOrder.css" />
</head>

<body>
<!-- 头部栏位 -->
<!--页面顶部-->
<div id="nav-bottom">
    <!--顶部-->
    <div class="nav-top">
        <div class="top">
            <div class="py-container">
                <div class="shortcut">
                    <div id="checkIfLogin">
                        <ul class="fl">
                            <li class="f-item">品优购欢迎您！</li>
                            <li class="f-item">请<a href="login.html" target="_blank">登录</a>　<span><a
                                    href="register.html" target="_blank">免费注册&ensp;&ensp;</a></span></li>
                        </ul>
                    </div>
                    <ul class="fr">
                        <li class="f-item"><a href="home-index.html">我的订单</a></li>
                        <li class="f-item space"></li>
                        <li class="f-item"><a href="cart1.html" target="_blank">我的购物车</a></li>
                        <li class="f-item space"></li>
                        <li class="f-item"><a href="favourite.html" target="_blank">我的收藏</a></li>
                        <li class="f-item space"></li>
                        <li class="f-item"><a href="records.html" target="_blank">我的足迹</a></li>
                        <li class="f-item space"></li>
                        <li class="f-item" id="service">
                            <span>客户服务</span>
                            <ul class="service">
                                <li><a href="cooperation.html" target="_blank">合作招商</a></li>
                                <li><a href="shoplogin.html" target="_blank">商家后台</a></li>
                                <li><a href="cooperation.html" target="_blank">合作招商</a></li>
                                <li><a href="#">商家后台</a></li>
                            </ul>
                        </li>
                        <li class="f-item space"></li>
                        <li class="f-item">网站导航</li>
                    </ul>
                </div>
            </div>
        </div>

        <!--头部-->
        <div class="header">
            <div class="py-container">
                <div class="yui3-g Logo">
                    <div class="yui3-u Left logoArea">
                        <a class="logo-bd" title="品优购" href="goodsList.html" target="_blank"></a>
                    </div>
                    <div class="yui3-u Center searchArea">
                        <div class="search">
                            <form action="" class="sui-form form-inline">
                                <!--searchAutoComplete-->
                                <div class="input-append">
                                    <input type="text" id="autocomplete" type="text" class="input-error input-xxlarge" />
                                    <button class="sui-btn btn-xlarge btn-danger" type="button">搜索</button>
                                </div>
                            </form>
                        </div>
                        <div class="hotwords">
                            <ul>
                                <li class="f-item">品优购首发</li>
                                <li class="f-item">亿元优惠</li>
                                <li class="f-item">9.9元团购</li>
                                <li class="f-item">每满99减30</li>
                                <li class="f-item">亿元优惠</li>
                                <li class="f-item">9.9元团购</li>
                                <li class="f-item">办公用品</li>

                            </ul>
                        </div>
                    </div>
                    <div class="yui3-u Right shopArea">
                        <div class="fr shopcar">
                            <div class="show-shopcar" id="shopcar">
                                <span class="car"></span>
                                <a class="sui-btn btn-default btn-xlarge" href="cart.html" target="_blank">
                                    <span>我的购物车</span>
                                </a>
                                <div class="clearfix shopcarlist" id="shopcarlist" style="display:none">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="yui3-g NavList">
                    <div class="yui3-u Left all-sort">
                        <h4>全部商品分类</h4>
                    </div>
                    <div class="yui3-u Center navArea">
                        <ul class="nav">
                        </ul>
                    </div>
                    <div class="yui3-u Right"></div>
                </div>
            </div>
        </div>
    </div>
</div>

<script type="text/javascript" src="js/plugins/jquery/jquery.min.js"></script>
<script type="text/javascript">
    $(function(){
        $("#service").hover(function(){
            $(".service").show();
        },function(){
            $(".service").hide();
        });
        $("#shopcar").hover(function(){
            $("#shopcarlist").show();
        },function(){
            $("#shopcarlist").hide();
        });

    })
</script>
<script type="text/javascript" src="js/plugins/jquery.easing/jquery.easing.min.js"></script>
<script type="text/javascript" src="js/plugins/sui/sui.min.js"></script>
<script type="text/javascript" src="js/plugins/jquery-placeholder/jquery.placeholder.min.js"></script>
<script type="text/javascript" src="js/widget/nav.js"></script>
</body>
<!--header-->
<div id="account">
    <div class="py-container">
        <div class="yui3-g home">
            <!--左侧列表-->
            <div class="yui3-u-1-6 list">
                <div class="list-items">
                    <dl>
                        <dt><i>·</i> 订单中心</dt>
                        <dd ><a href="home-index.html"  class="list-active" >我的订单</a></dd>
                        <dd><a href="home-order-pay.html" >待付款</a></dd>
                    </dl>
                    <dl>
                        <dt><i>·</i> 我的中心</dt>
                        <dd><a href="favourite.html">我的收藏</a></dd>
                        <dd><a href="records.html">我的足迹</a></dd>
                    </dl>
                    <dl>
                        <dt><i>·</i> 设置</dt>
                        <dd><a href="dataRevise.html">个人信息</a></dd>
                        <dd><a href="shipAddress.html"  >地址管理</a></dd>
                        <!--<dd><a href="" >安全管理</a></dd>-->
                    </dl>
                </div>
            </div>
            <!--右侧主内容-->
            <div class="yui3-u-5-6 order-pay">
                <table class="table  table-bordered" id="dataTable">
                    <thead>
                    <tr>
                        <th class="" style="padding-right:0px">
                            <input id="selall" type="checkbox" class="icheckbox_square-blue" onclick="swapCheck()">
                        </th>
                        <th style="display:none"></th>
                        <th>商品ID</th>
                        <th>商品名</th>
                        <th>价格</th>
                        <th>创建时间</th>
                        <th>图片</th>
                        <th width="100">操作</th>
                    </tr>
                    </thead>
                    <tbody>
                    </tbody>
                    <div align="right">
                        <button onclick="allDel()">批量删除</button>
                    </div>


                </table>
                <div class="contant">
                    <ul id="dataUl">
                    </ul>

                    <div class="pageNum">
                        <ul class="pagination">
                            <li><a href="">首页</a></li>
                            <li class="threeword"><a href="#">上一页</a></li>
                            <li><a href="#">1</a></li>
                            <li><a href="#">2</a></li>
                            <li><a href="#">3</a></li>
                            <li><a href="#">4</a></li>
                            <li><a href="#">5</a></li>
                            <li><a href="#">6</a></li>
                            <li><a href="#">7</a></li>
                            <li><a href="#">8</a></li>
                            <li><a href="#">9</a></li>
                            <li><a href="#">10</a></li>
                            <li class="threeword"><a href="javascript:;">下一页</a></li>
                            <li class="threeword"><a href="javascript:;">末页</a></li>
                        </ul>
                    </div>
                </div>

            </div>
        </div>
    </div>
</div>
<!-- 底部栏位 -->
<!--页面底部-->
<div class="clearfix footer">
    <div class="py-container">
        <div class="footlink">
            <div class="Mod-service">
                <ul class="Mod-Service-list">
                    <li class="grid-service-item intro  intro1">

                        <i class="serivce-item fl"></i>
                        <div class="service-text">
                            <h4>正品保障</h4>
                            <p>正品保障，提供发票</p>
                        </div>

                    </li>
                    <li class="grid-service-item  intro intro2">

                        <i class="serivce-item fl"></i>
                        <div class="service-text">
                            <h4>正品保障</h4>
                            <p>正品保障，提供发票</p>
                        </div>

                    </li>
                    <li class="grid-service-item intro  intro3">

                        <i class="serivce-item fl"></i>
                        <div class="service-text">
                            <h4>正品保障</h4>
                            <p>正品保障，提供发票</p>
                        </div>

                    </li>
                    <li class="grid-service-item  intro intro4">

                        <i class="serivce-item fl"></i>
                        <div class="service-text">
                            <h4>正品保障</h4>
                            <p>正品保障，提供发票</p>
                        </div>

                    </li>
                    <li class="grid-service-item intro intro5">

                        <i class="serivce-item fl"></i>
                        <div class="service-text">
                            <h4>正品保障</h4>
                            <p>正品保障，提供发票</p>
                        </div>

                    </li>
                </ul>
            </div>
            <div class="clearfix Mod-list">
                <div class="yui3-g">
                    <div class="yui3-u-1-6">
                        <h4>购物指南</h4>
                        <ul class="unstyled">
                            <li>购物流程</li>
                            <li>会员介绍</li>
                            <li>生活旅行/团购</li>
                            <li>常见问题</li>
                            <li>购物指南</li>
                        </ul>

                    </div>
                    <div class="yui3-u-1-6">
                        <h4>配送方式</h4>
                        <ul class="unstyled">
                            <li>上门自提</li>
                            <li>211限时达</li>
                            <li>配送服务查询</li>
                            <li>配送费收取标准</li>
                            <li>海外配送</li>
                        </ul>
                    </div>
                    <div class="yui3-u-1-6">
                        <h4>支付方式</h4>
                        <ul class="unstyled">
                            <li>货到付款</li>
                            <li>在线支付</li>
                            <li>分期付款</li>
                            <li>邮局汇款</li>
                            <li>公司转账</li>
                        </ul>
                    </div>
                    <div class="yui3-u-1-6">
                        <h4>售后服务</h4>
                        <ul class="unstyled">
                            <li>售后政策</li>
                            <li>价格保护</li>
                            <li>退款说明</li>
                            <li>返修/退换货</li>
                            <li>取消订单</li>
                        </ul>
                    </div>
                    <div class="yui3-u-1-6">
                        <h4>特色服务</h4>
                        <ul class="unstyled">
                            <li>夺宝岛</li>
                            <li>DIY装机</li>
                            <li>延保服务</li>
                            <li>品优购E卡</li>
                            <li>品优购通信</li>
                        </ul>
                    </div>
                    <div class="yui3-u-1-6">
                        <h4>帮助中心</h4>
                        <img src="img/wx_cz.jpg">
                    </div>
                </div>
            </div>
            <div class="Mod-copyright">
                <ul class="helpLink">
                    <li>关于我们<span class="space"></span></li>
                    <li>联系我们<span class="space"></span></li>
                    <li>关于我们<span class="space"></span></li>
                    <li>商家入驻<span class="space"></span></li>
                    <li>营销中心<span class="space"></span></li>
                    <li>友情链接<span class="space"></span></li>
                    <li>关于我们<span class="space"></span></li>
                    <li>营销中心<span class="space"></span></li>
                    <li>友情链接<span class="space"></span></li>
                    <li>关于我们</li>
                </ul>
                <p>地址：北京市昌平区建材城西路金燕龙办公楼一层 邮编：100096 电话：400-618-4000 传真：010-82935100</p>
                <p>京ICP备08001421号京公网安备110108007702</p>
            </div>
        </div>
    </div>
</div>
<!--页面底部END-->
<script>
    // 判断用户是否登录
    console.log("判断是否登录!");

    $.ajax({
        url: "http://localhost:8080//checkIfLogin",
        success: function (result) {
            console.log("success检测用户是否登录")
            if (result) {
                $("#checkIfLogin").html("");
                $(result).each(function (index, item) {
                    var trStr = "<ul class=\"fl\">";
                    trStr += "<li class=\"f-item\">品优购欢迎您！</li>";
                    trStr += "<li class=\"f-item\">" + item.username + "</li>&ensp;&ensp;";
                    trStr += "<li class=\"f-item\"><span><a onclick=\"logOut()\" target=\"_blank\">退出</a></span></li>";
                    trStr += "</ul>";
                    $("#checkIfLogin").append(trStr);
                    console.log("用户已登陆");
                    //console.log(item);
                    sessionStorage.setItem("userid", item.userid);

                });
            } else {
                console.log("用户未登录");
                //提示登录 跳转到登录页
                var b = confirm("请先登录!");
                if (b == true) {
                    window.location.href = "login.html";
                } else if (b == false) {
                    //window.location.href = "product_details.html";
                }
            }

            //}
            // console.log("sessionStorageUserid:" + sessionStorageUserid);
        },
        error: function (e) {
            console.log(e);
            console.log(e.status);
            console.log(e.responseText);
        }
    })
</script>
<script>
    /**
     * 初始化页面
     */
    var pageNum = 1;
    function initPage(pageNum) {
        //1.从后台的listAllGoodsInfo接口获取数据
        $.ajax({
            //请求方式GET/POST
            type: "POST",
            //请求的媒体类型
            contentType: "application/json;charset=UTF-8",
            //接受数据类型
            dataType: "json",
            //请求地址
            data: JSON.stringify({
                "pageNum":pageNum,
            }),
            url: "http://localhost:8080//listAllRecords",
            success: function (result) {
                var pages = result.pages;
                console.log(result);
                $("#dataTable tbody").html("");
                $(result.list).each(function (index, item) {
                    console.log(item);
                    var trStr = "<tr>";
                    trStr += "<td><input type=\"checkbox\" name='ids'></td>";
                    trStr += "<td style='display:none'>" + item.recordsid + "</td>";
                    trStr += "<td >" + item.goodsid + "</td>";
                    trStr += "<td onclick='toProductDetails(" + item.goodsid + ")'>" + item.goodsname + "</td>";
                    trStr += "<td >" + item.goodsprice + "</td>";
                    trStr += "<td >" + item.createtime + "</td>";
                    trStr+= "<td>"+"<img src="+item.goodspic+" width=100px height=100px>"+"</td>";
                    trStr += "<td>";
                    trStr += "<button  onclick='addCart(" + item.goodsid + ")'>添加到购物车</button>";
                    // trStr += "<button type=\"button\" class='btn btn-primary btn-xs' onclick='toProductDetails(" + item.goodsid + ")'><i class=' glyphicon glyphicon-pencil' ></i></button>&nbsp;";
                    trStr += "<button onclick='removeRecordsGoods(" + item.recordsid + ")'>删除记录</button>";

                    /* trStr += "<div>";
                     trStr += "<a class='sui-btn btn-block btn-buy' href='buy-item.html' target='_blank'>";
                     trStr += "立即购买";
                     trStr += "</a>";
                     trStr += "</div>";*/
                    trStr += "</td>";
                    trStr += "</tr>";
                    $("#dataTable").append(trStr);
                });
                var splitePageStr ="<li><a onclick='initPage(1)' href='#top'>首页</a></li>";
                splitePageStr+="<li class=\"threeword\"><a onclick='initPage("+result.prePage+" )' href='#top'>上一页</a></li>";
                for(var i=1;i<=result.lastPage;i++){
                    splitePageStr +="<li><a onclick='initPage("+i+")'>"+i+"</a></li>";
                }
                splitePageStr += "<li class=\"threeword\"><a onclick='initPage("+result.nextPage+" )' href='#top'>下一页</a></li>";
                splitePageStr+="<li class=\"threeword\"><a onclick='initPage("+pages+" )' href='#top'>末页</a></li>";
                $(".pagination").html("");
                $(".pagination").append(splitePageStr);
            }
            ,
            //请求失败，包含具体的错误信息
            error: function (e) {
                console.error(e);
                console.log(e.status);
                console.log(e.responseText);
            }
        })
        ;
    }
    initPage(pageNum);

    var isCheckAll = false;

    // input框check属性控制 全选
    function swapCheck() {
        if (isCheckAll) {
            $("input[type='checkbox']").each(function () {
                this.checked = false;
            });
            isCheckAll = false;
        } else {
            $("input[type='checkbox']").each(function () {
                this.checked = true;
            });
            isCheckAll = true;
        }
    }
    // 全选删除
    function allDel() {
        var ids = [];
        // 获取选中的id
        $('input:checkbox:checked').parent().next().each(function (idx, element) {
            ids.push($(element).text());
        });
        var obj = {"ids": ids};
        console.log(obj);
        if (window.confirm("您确认要从我的足迹中移除这些商品吗？")) {
            $.ajax({
                type: "POST",
                url: "/allDelRecords",
                data: $.param(obj, true), // 数组序列化
                dataType: "json",
                success: function (result) {
                    if (result.type == "success") {
                        //刷新页面
                        window.location.reload()
                    }
                },
                error: function (result) {
                    if (result.type == "error") {
                        alert("删除失败!");
                    }
                }
            });
            return true;
        } else {
            return false;
        }
    }
    // 加入购物车并判断是否登录
    function addCart(goodsid) {
        // 先判断是否登录
        var userid = sessionStorage.getItem("userid");
        console.log("登录用户id为" + userid);
        //alert(userid);
        //alert(goodsid);
        if (userid != null) {
            $.ajax({
                //请求方式GET/POST
                type: "POST",
                //请求的媒体类型
                contentType: "application/json;charset=UTF-8",
                //接受数据类型
                dataType: "json",
                //请求地址
                url: "http://localhost:8080//addCart",

                data: JSON.stringify({
                    "userid": userid,
                    "goodsid": goodsid
                }),
                success: function (result) {
                    console.log(result);
                    if (result) {
                        alert("加入购物车")
                    } else {
                        alert("加入购物车失败")
                    }
                },
                error: function (e) {
                    console.log(e);
                    console.log(e.status);
                    console.log(e.responseText);
                }
            })
        } else {
            //提示登录 跳转到登录页
            var b = confirm("请先登录!");
            if (b == true) {
                window.location.href = "login.html";
            }
        }

    }
    // 商品详情
    function toProductDetails(goodsid) {
        //window.location.href = "product_details.html?id="+goodsid;
        // 先判断是否登录
        var userid = sessionStorage.getItem("userid");

        sessionStorage.setItem("goodsid",goodsid);
        console.log("登录用户id为" + userid);
        console.log("商品id为" + goodsid);
        //window.location.href = "product_details.html";
        if (userid != null && userid != 0 && goodsid != null && goodsid != 0) {
            $.ajax({
                //请求方式GET/POST
                type: "POST",
                //请求的媒体类型
                contentType: "application/json;charset=UTF-8",
                //接受数据类型
                dataType: "json",
                data: JSON.stringify({
                    "userid": userid,
                    "goodsid": goodsid
                }),
                //请求地址
                url: "http://localhost:8080//addToRecords",
                success: function (result) {
                    console.log("保存id到我的足迹完成");
                    if (result) {
                        alert(goodsid)
                        window.location.href = "product_details.html?id="+goodsid;
                    } else {
                    }
                },
                error: function (e) {
                    console.log(e);
                    console.log(e.status);
                    console.log(e.responseText);
                }
            });
        } else {
            //提示登录 跳转到登录页
            var b = confirm("请先登录!");
            if (b == true) {
                window.location.href = "login.html";
            } else if (b == false) {
                window.location.href = "product_details.html";
            }
        }

    }
    // 单个移除商品
    function removeRecordsGoods(id) {
        //ajax--》调用方法
        $.ajax({
            //请求方式GET/POST
            type: "GET",
            //请求的媒体类型
            contentType: "application/json;charset=UTF-8",
            //接受数据类型
            dataType: "json",
            //请求地址
            url: "http://localhost:8080//removeRecordsGoods?id=" + id,
            //数据，json字符串
            //请求成功
            success: function (result) {
                if (result) {
                    alert("删除成功");
                    initPage();
                } else {
                    alert("删除失败")
                }
            },
            error: function (e) {
                console.log(e);
            }
        })
    }
</script>
</html>